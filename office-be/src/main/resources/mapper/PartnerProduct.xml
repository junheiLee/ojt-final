<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ojt_final.office.dao.PartnerProdDao">

    <insert id="saveAll" parameterType="PartnerProd">
        INSERT INTO tPartnerProduct (
                        sPartnerProductCode,
                        sPartnerCode,
                        nCategoryCode,
                        sPartnerProductName,
                        nPcPrice,
                        nMobilePrice,
                        sUrl,
                        sImageUrl,
                        dtCreatedAt
                        )
        VALUES
            <foreach collection="list" item="PartnerProd" separator="," >
                (
                 #{PartnerProd.code},
                 #{PartnerProd.partnerCode},
                 #{PartnerProd.categoryCode},
                 #{PartnerProd.name},
                 #{PartnerProd.pcPrice},
                 #{PartnerProd.mobilePrice},
                 #{PartnerProd.url},
                 #{PartnerProd.imageUrl},
                 #{PartnerProd.createdAt}
                )
            </foreach>
        ON DUPLICATE KEY UPDATE
                sPartnerProductName = VALUES(sPartnerProductName),
                nCategoryCode = VALUES(nCategoryCode),
                nPcPrice = VALUES(nPcPrice),
                nMobilePrice = VALUES(nMobilePrice),
                sImageUrl = VALUES(sImageUrl)
    </insert>

    <select id="countAll">
        SELECT COUNT(sPartnerProductCode)
        FROM tPartnerProduct
    </select>

    <select id="selectByCond" parameterType="PartnerProdCond" resultType="PartnerProd">
        SELECT P.sPartnerName AS partnerName,
               C.sCategoryName AS categoryName,
               PP.sPartnerProductName AS name,
               PP.sImageUrl AS imageUrl,
               PP.sUrl AS url,
               PP.nPcPrice AS pcPrice,
               PP.nMobilePrice AS mobilePrice,
               pp.dtCreatedAt AS createdAt
        FROM tPartnerProduct PP
        INNER JOIN tCategory C ON (PP.nCategoryCode = C.nCategoryCode)
        INNER JOIN tPartner P ON (PP.sPartnerCode = P.sPartnerCode)
        <where>
            <if test="categoryCode != null and categoryCode != ''">
                AND C.nCategoryCode = #{categoryCode}
            </if>
        </where>
        <trim prefix="ORDER BY" prefixOverrides=",">
            <if test="sort.name != '' and sort.name == 'ASC'">
                ,sPartnerProductName ASC
            </if>
            <if test="sort.name != '' and sort.name == 'DESC'">
                ,sPartnerProductName DESC
            </if>
            <if test="sort.createdAt != '' and sort.createdAt == 'ASC'">
                ,dtCreatedAt ASC
            </if>
            <if test="sort.name == '' and sort.createdAt == ''">
                ,dtCreatedAt DESC
            </if>
        </trim>
        LIMIT #{limit}
        OFFSET #{offset}

    </select>

    <select id="countAllByCond" parameterType="Cond">
        SELECT COUNT(sPartnerProductCode)
        FROM tPartnerProduct
        <where>
            <if test="categoryCode != null">
                nCategoryCode = #{categoryCode}
            </if>
        </where>
    </select>

    <update id="updateAllIsLinked">
        UPDATE tPartnerProduct
        SET bIsLinked = #{isLinked}
        WHERE sPartnerProductCode IN (
            <foreach collection="codes" item="code" separator=", ">
                #{code}
            </foreach>
        )
    </update>
</mapper>
